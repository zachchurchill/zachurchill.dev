{% extends "admin/change_form.html" %}
{% load static %}

{% block field_sets %}
{% if original.unique_url %}
<div class="module aligned">
    <h2>Form Access</h2>
    <div class="form-row">
        <div>
            <label>Form Link:</label>
            <div class="readonly">
                <a href="{{ original.get_form_url }}" target="_blank" style="font-size: 16px; font-weight: bold; color: #007cba; text-decoration: none; padding: 8px 12px; border: 2px solid #007cba; border-radius: 4px; display: inline-block;">
                    ðŸ”— Open Volunteer Form
                </a>
                <br><br>
                <small style="color: #666;">
                    <strong>Unique URL:</strong> {{ original.unique_url }}<br>
                    <strong>Full URL:</strong> <a href="{{ original.get_form_url }}" target="_blank">{{ original.get_form_url }}</a>
                </small>
            </div>
        </div>
    </div>
</div>
{% endif %}
{{ block.super }}
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript">
(function($) {
    'use strict';
    
    // Store volunteer type data
    var volunteerTypeData = {};
    
    // Fetch volunteer type data when page loads
    $(document).ready(function() {
        // Get volunteer type data from API
        $.ajax({
            url: '{% url "admin:volunteer-types" %}',
            method: 'GET',
            success: function(data) {
                // Store volunteer type data
                data.forEach(function(type) {
                    volunteerTypeData[type.name] = type.description;
                });
            },
            error: function() {
                console.log('Could not fetch volunteer type data');
            }
        });
        
        // Handle volunteer type selection changes in inline forms
        $(document).on('change', 'select[name*="volunteer_type"]', function() {
            var select = $(this);
            var row = select.closest('tr');
            var titleField = row.find('input[name*="title"]');
            var descriptionField = row.find('textarea[name*="description"]');
            var selectedOption = select.find('option:selected');
            var selectedText = selectedOption.text();
            
            if (selectedText && selectedText !== '---------') {
                // Auto-populate title with the volunteer type name
                titleField.val(selectedText);
                
                // Auto-populate description from volunteer type data
                if (volunteerTypeData[selectedText]) {
                    descriptionField.val(volunteerTypeData[selectedText]);
                }
            }
        });
    });
    
})(django.jQuery);
</script>
{% endblock %}
